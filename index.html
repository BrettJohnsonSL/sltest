<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>sltest</title>
	<link rel="stylesheet" type="text/css" href="/css/jquery.dataTables.min.css">
	<style>
	td.details-control {
	background: url('../img/details_open.png') no-repeat center center;
	cursor: pointer;
	}
	tr.shown td.details-control {
	background: url('../img/details_close.png') no-repeat center center;
	}
	</style>
	<script type="text/javascript" language="javascript" src="/js/jquery-3.5.1.min.js"></script>
	<script type="text/javascript" language="javascript" src="/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" class="init">
	

	function draw_actions(id, desc) {
		// functions added to each table row specific to that to-do entry
		return '<a href="#" onclick="javascript:edit_description(' + id + '); return false;">Edit Description</a>'+
			'<br>'+
			'<a href="#" onclick="javascript:complete_todo(' + id + '); return false;">Mark Done</a>'
			'<br>'+
			'<a href="#" onclick="javascript:delete_todo(' + id + '); return false;">Delete</a>';
			
	}
	function populate() {  
		// fetch json from the api and iterate to initially populate the display table
		$.get("/api/list_todo", function(data) {
			var table = $('#sltable').DataTable({ "order": [[ 3, "desc" ]] });

			for (var row in data) {
				console.log('Adding row #' + row);
				var row_name = data[row].name;
				var row_id = data[row].id;
				var row_completed = data[row].completed;
				var row_desc = data[row].description;
				var row_due = data[row].due;
				var actions = draw_actions(row_id,row_desc);
				//var actions = 'test';
				if (row_desc >= 1) { var pretty = 'Completed' } else { var pretty = 'Incomplete' }
				table.row.add([
					row_id,
					row_name,
					row_due,
					pretty,
					actions
				]); 
			}
			table.draw();
		},"json");
	}

	function complete_todo(id) {	// mark a to-do as done and verify response from the api
		$.get('/api/complete?id=' + id, function() {
			console.log('Marked ID#'+id+' as done.');
		})
	}

	function delete_todo(id) {	// delete a todo
		$.get('/api/delete?id=' + id,function() {
			console.log('Delete #'+id);
		});
	}

	function edit_todo(id) { 	// edit
		$.get('/api/update?id=' + id,function() {
			console.log('Edit #'+id);
		});
	}

	function new_todo(name,desc,due) {		// new todo - dynamically add a new row without a second API call assuming the insert query returns successful?
		$.get('/api/new',function() {
			console.log('New with name=' + name + ' and desc = ' + desc + ' and due = ' + due);
		});
	}

function init() {
	populate();
}
 
$(document).ready(function() { init() });

	</script>
</head>

<body>
	<h3>Practical Coding Assessment</h3>
	<hr>
	<div class="display"  style="width:50%">
		<table id="sltable" class="display">
			<thead>
				<tr>
					<th>ID</th>
					<th>Name</th>
					<th>Due</th>
					<th>Status</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</body>
<hr>
<h3>New</h3>
<div id="newtodo" class="display" style="width:50%">
	<form method="POST" action=="/api/new">
		Name: <input type="text" name="name"><br>
		Due Date: <input type="text" name="due"><br>
		Description: <textarea name="description"></textarea><br>
	</form>
</div>
<br>
<h3>Edit</h3>
<div id="editodo" class="display" style="width:50%">
	<form method="POST" action=="/api/update">
		ID: <input type="text" name="name" readonly><br>
		Name: <input type="text" name="name"><br>
		Due Date: <input type="text" name="due"><br>
		Description: <textarea name="description"></textarea><br>
		Status: <input type="text" name="status"><br>
	</form>
</div>
</html>
