<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>sltest</title>
	<link rel="stylesheet" type="text/css" href="/css/jquery.dataTables.min.css">
	<style>
	td.details-control {
	background: url('../img/details_open.png') no-repeat center center;
	cursor: pointer;
	}
	tr.shown td.details-control {
	background: url('../img/details_close.png') no-repeat center center;
	}
	</style>
	<script type="text/javascript" language="javascript" src="/js/jquery-3.5.1.min.js"></script>
	<script type="text/javascript" language="javascript" src="/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" class="init">
	

	function draw_actions(id, desc) {
		return '<a href="#" onclick="javascript:edit_description(' + id + '); return false;">Edit Description</a>'+
			'<br>'+
			'<a href="#" onclick="javascript:complete_todo(' + id + '); return false;">Mark Done</a>'
			'<br>'+
			'<a href="#" onclick="javascript:delete_todo(' + id + '); return false;">Delete</a>';
			
	}
	function populate() {  
		// fetch json from the api and iterate to initially populate the display table
		$.get("/api/list_todo", function(data) {
			var table = $('#sltable').DataTable({ "order": [[ 3, "desc" ]] });

			for (var row in data) {
				console.log('Adding row #' + row);
				var row_name = data[row].name;
				var row_id = data[row].id;
				var row_completed = data[row].completed;
				var row_desc = data[row].description;
				var row_due = data[row].due;
				var actions = draw_actions(row_id,row_desc);
				//var actions = 'test';
				if (row_desc >= 1) { var pretty = 'Completed' } else { var pretty = 'Incomplete' }
				table.row.add([
					row_id,
					row_name,
					row_due,
					pretty,
					actions
				]);
			}
			table.draw();
		},"json");
	}

function init() {
	populate();
}
 
$(document).ready(function() { init() });

	</script>
</head>

<body>
	<div class="display"  style="width:50%">
		<table id="sltable" class="display">
			<thead>
				<tr>
					<th>ID</th>
					<th>Name</th>
					<th>Due</th>
					<th>Status</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</body>
</html>
